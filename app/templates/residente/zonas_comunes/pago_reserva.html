<div class="profile-card">
    <h3 class="profile-title">
        <i class="fas fa-receipt"></i> Subir comprobante para la Reserva {{ reserva.id_reserva }}
    </h3>
    <div class="space-y-4">
        {% if pago_actual and pago_actual.estado %}
            <div class="alert-modern alert-success">
                <i class="fas fa-check-circle"></i>
                <div>El pago fue aprobado por el administrador.</div>
            </div>
        {% elif mostrar_alerta %}
            <div class="alert-modern alert-info">
                <i class="fas fa-clock"></i>
                <div>{{ mostrar_alerta }}</div>
            </div>
        {% elif form %}
            <form method="POST" enctype="multipart/form-data">
                {% csrf_token %}
                <div class="form-group">
                    {{ form.as_p }}
                </div>
                <div class="d-grid">
                    <button type="submit" class="btn-modern">
                        <i class="fas fa-save"></i> Guardar Pago
                    </button>
                </div>
            </form>
        {% else %}
            <div class="empty-state">
                <i class="fas fa-hourglass-half"></i>
                <div>Ya subiste ambos comprobantes, espera validaci√≥n del administrador.</div>
            </div>
        {% endif %}
    </div>
</div>

<div class="profile-card">
    <h3 class="profile-title">
        <i class="fas fa-file-invoice"></i> Comprobantes Subidos
    </h3>
    <div class="space-y-4" id="lista-pagos-reserva">
        {% include "residente/zonas_comunes/tabla_pagos_residente.html" %}
    </div>
</div>

<script>
(function() {
    const reservaId = "{{ reserva.id_reserva }}";
    const usuarioId = "{{ request.usuario.id_usuario }}";

    const socket = new WebSocket(
        (window.location.protocol === "https:" ? "wss://" : "ws://") +
        window.location.host +
        "/ws/pagos-reserva-user/" + usuarioId + "/" + reservaId + "/"
    );

    socket.onmessage = function(event) {
        const data = JSON.parse(event.data);
        if (["created", "updated", "deleted"].includes(data.action)) {
            document.getElementById("lista-pagos-reserva").innerHTML = data.html;
        }
    };

    socket.onclose = function() {
        console.log("WebSocket cerrado. Reintentando en 5 segundos...");
        setTimeout(() => location.reload(), 5000);
    };
})();
</script>
